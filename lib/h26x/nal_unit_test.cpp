#include <gtest/gtest.h>

#include "nal_unit.hpp"

TEST(nal_unit, decode) {
	const unsigned char data[] = {
        0x67, 0x4d, 0x40, 0x1f, 0xec, 0xa0, 0x28, 0x02, 0xdd, 0x80, 0xb5, 0x01, 0x01, 0x01, 0x40,
        0x00, 0x00, 0x03, 0x00, 0x40, 0x00, 0x05, 0xdc, 0x03, 0xc6, 0x0c, 0x65, 0x80,
	};
    h264::bitstream bs(data, sizeof(data));

    h264::nal_unit nalu;
    ASSERT_FALSE(nalu.decode(&bs, sizeof(data)));

    EXPECT_EQ(0, nalu.forbidden_zero_bit);
    EXPECT_EQ(3, nalu.nal_ref_idc);
    EXPECT_EQ(h264::NALUnitType::SequenceParameterSet, nalu.nal_unit_type);

    EXPECT_EQ(std::vector<uint8_t>({
        0x4d, 0x40, 0x1f, 0xec, 0xa0, 0x28, 0x02, 0xdd, 0x80, 0xb5, 0x01, 0x01, 0x01, 0x40, 0x00,
        0x00, 0x00, 0x40, 0x00, 0x05, 0xdc, 0x03, 0xc6, 0x0c, 0x65, 0x80,
	}), nalu.rbsp_byte);
}

